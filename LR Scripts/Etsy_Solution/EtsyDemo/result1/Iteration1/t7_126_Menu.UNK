(window["jsonp-common-entrypoints"]=window["jsonp-common-entrypoints"]||[]).push([["auto/@etsy-modules/CategoryNav/Views/DropdownMenu/CardsDropdown/Menu","auto/@etsy-modules/CategoryNav/NavHandlers/Overlay"],{"+s1y":function(e,t,i){e.exports=i("VYFw")("+s1y")},"68KA":function(e,t,i){"use strict";i.r(t);i.d(t,"Overlay",(function(){return a}));var n=i("w1yB");function s(e,t,i){t in e?Object.defineProperty(e,t,{value:i,enumerable:true,configurable:true,writable:true}):e[t]=i;return e}const o={OVERLAY_OPEN:"overlay-open",OVERLAY_CLOSE:"overlay-close"};const r={HEADER_WRAPPER:"[data-selector='header-cat-nav-wrapper']"};class a{constructor(e,t){s(this,"container",void 0);s(this,"overlay",void 0);s(this,"activeTriggers",void 0);this.container=e;this.overlay=t;this.activeTriggers=[];this.bindEventListeners();this.openOverlay=this.openOverlay.bind(this);this.closeOverlay=this.closeOverlay.bind(this)}bindEventListeners(){this.container.addEventListener(o.OVERLAY_OPEN,(e=>{e instanceof CustomEvent&&this.openOverlay(e)}));this.container.addEventListener(o.OVERLAY_CLOSE,(e=>{e instanceof CustomEvent&&this.closeOverlay(e)}));this.overlay.addEventListener("click",(()=>{this.activeTriggers=[];this.overlay.classList.remove("wt-overlay--will-animate");this.overlay.setAttribute("aria-hidden","true")}))}openOverlay(e){var t;const i=null===(t=e.detail)||void 0===t?void 0:t.target;if("undefined"!==typeof i&&null!==i){const e=this.activeTriggers.indexOf(i);-1===e&&this.activeTriggers.push(i);if(this.overlay){this.overlay.classList.add("wt-overlay--will-animate");this.overlay.setAttribute("aria-hidden","false")}}}closeOverlay(e){var t;const i=null===(t=e.detail)||void 0===t?void 0:t.target;const n=this.activeTriggers.indexOf(i);if("undefined"!==typeof i&&null!==i){-1!==n&&this.activeTriggers.splice(n,1);if(0===this.activeTriggers.length&&this.overlay){this.overlay.classList.remove("wt-overlay--will-animate");this.overlay.setAttribute("aria-hidden","true")}}}static dispatchOpenBackgroundOverlayIfEligible(e){if(n["default"].getBoolean("has_dropdown_background_overlay",false)&&e instanceof HTMLElement){var t;const i=new CustomEvent(o.OVERLAY_OPEN,{detail:{target:e}});null===(t=document.querySelector(r.HEADER_WRAPPER))||void 0===t?void 0:t.dispatchEvent(i)}}static dispatchCloseBackgroundOverlayIfEligible(e){if(n["default"].getBoolean("has_dropdown_background_overlay",false)&&e instanceof HTMLElement){var t;const i=new CustomEvent(o.OVERLAY_CLOSE,{detail:{target:e}});null===(t=document.querySelector(r.HEADER_WRAPPER))||void 0===t?void 0:t.dispatchEvent(i)}}}},"7rax":function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));function n(e,t,i){t in e?Object.defineProperty(e,t,{value:i,enumerable:true,configurable:true,writable:true}):e[t]=i;return e}class s{constructor(e){n(this,"timeout",null);n(this,"promise",void 0);this.promise=0===e?Promise.resolve():new Promise((t=>{this.timeout=setTimeout(t,e)}))}getPromise(){return this.promise}cancel(){this.timeout&&clearTimeout(this.timeout)}then(e){return this.promise.then(e)}}},I5vg:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var n=i("KWsK");function s(e,t){if(e)return true;const i=new Error(t);false;n["default"].captureException(i);return false}},Kyuy:function(e,t,i){"use strict";i.d(t,"a",(function(){return p}));var n=i("YDjr");var s=i("foay");var o=i("jdS7");var r=i("7rax");function a(e,t,i){t in e?Object.defineProperty(e,t,{value:i,enumerable:true,configurable:true,writable:true}):e[t]=i;return e}class l extends o["a"]{constructor(e,t,i){super();a(this,"state",void 0);a(this,"options",void 0);a(this,"ui",void 0);a(this,"id",void 0);a(this,"_animationTimeout",void 0);a(this,"_docClickListener",void 0);a(this,"triggerSizeAndPosition",void 0);a(this,"menuBodyHeight",void 0);a(this,"menuBodyWidth",void 0);a(this,"currentFocusIdx",void 0);a(this,"vertOpenDirection",void 0);a(this,"horizOpenDirection",void 0);a(this,"$allMenuItems",void 0);this.options={...l.DEFAULT_OPTIONS,...t};this.state={...l.DEFAULT_STATE,...i};this.ui={element:e,trigger:e.querySelector(n["h"].TRIGGER_ELEMENT),body:e.querySelector(n["h"].BODY_ELEMENT),items:e.querySelectorAll(n["h"].MENU_ITEMS)};this.id=this.ui.element.getAttribute("id");this._animationTimeout=null;this._docClickListener=null;this.options.hideTriggerOnOpen&&this.ui.element.classList.add(n["a"].HIDE_TRIGGER)}updateMenuItemRefs(){var e;this.ui.items=null===(e=this.ui.body)||void 0===e?void 0:e.querySelectorAll(n["h"].MENU_ITEMS)}open(e){var t,i,s,o,a,d,u;if(this.state.isOpen||this.state.isOpening)return false;null===(t=this.ui.body)||void 0===t?void 0:t.classList.add(n["a"].WILL_ANIMATE);null===(i=this.ui.trigger)||void 0===i?void 0:i.classList.add(n["a"].TRIGGER_WILL_ANIMATE);this.setState({isClosing:false,isOpening:true});this.ui.items=null===(s=this.ui.body)||void 0===s?void 0:s.querySelectorAll(n["h"].MENU_ITEMS);this.triggerSizeAndPosition=null===(o=this.ui.trigger)||void 0===o?void 0:o.getBoundingClientRect();if(this.ui.body){const e=parseInt(getComputedStyle(this.ui.body).minWidth);this.triggerSizeAndPosition&&this.triggerSizeAndPosition.width&&this.triggerSizeAndPosition.width>e&&(this.ui.body.style.minWidth=`${this.triggerSizeAndPosition.width}px`)}this.menuBodyHeight=null===(a=this.ui.body)||void 0===a?void 0:a.offsetHeight;this.menuBodyWidth=null===(d=this.ui.body)||void 0===d?void 0:d.offsetWidth;this._setupVertOpen();this._setupHorizOpen();null===(u=this.ui.trigger)||void 0===u?void 0:u.setAttribute("aria-expanded","true");this._animationTimeout=new r["a"](this.options.animateIn?l.CONSTANTS.OPEN_ANIMATION_TIMEOUT:0);return this._animationTimeout.then((()=>{var t;null===(t=this.ui.trigger)||void 0===t?void 0:t.classList.remove(n["a"].TRIGGER_WILL_ANIMATE);this.setState({isClosing:false,isOpening:false,isOpen:true});this._animationTimeout=null;this._docClickListener=this._handleOutsideClickClose.bind(this);if(this._docClickListener){document.addEventListener("click",this._docClickListener);document.addEventListener("touchstart",this._docClickListener)}this._resetFocus(e)}))}_resetFocus(e){var t;this.ui.items=null===(t=this.ui.body)||void 0===t?void 0:t.querySelectorAll(n["h"].MENU_ITEMS);const i=this.ui.items;if(i){const t=Array.from(i).find((e=>true===e.hasAttribute("aria-checked")));e&&s["default"].isUpKey(e)?this._setFocus(i.length-1):e&&s["default"].isDownKey(e)?this._setFocus(0):t?this._setFocus(this._findItemIndex(t)):this._setFocus(0)}}_handleOutsideClickClose(e){if(this.state.isOpening||this.state.isClosing||!this.state.isOpen)return false;if((e.target instanceof HTMLElement||e.target instanceof Node)&&this.ui.element.contains(e.target))return false;this.close();return}close(){var e,t;if(this._animationTimeout){if(this.state.isClosing)return this._animationTimeout.getPromise();this._animationTimeout.cancel();this._animationTimeout=null}else if(!this.state.isOpen){this.setState({isClosing:false,isOpening:false,isOpen:false});return new r["a"](0).getPromise()}let i;try{var s;i=!(null===(s=this.ui.body)||void 0===s||!s.matches(":focus-within"))}catch(o){i=true}null===(e=this.ui.trigger)||void 0===e?void 0:e.classList.add(n["a"].TRIGGER_WILL_ANIMATE);this.setState({isClosing:true,isOpening:false});this.ui.element.classList.remove(n["a"].IS_OPEN);null===(t=this.ui.trigger)||void 0===t?void 0:t.setAttribute("aria-expanded","false");this._animationTimeout=new r["a"](this.options.animateIn?l.CONSTANTS.OPEN_ANIMATION_TIMEOUT:0);return this._animationTimeout.then((()=>{var e,t;null===(e=this.ui.body)||void 0===e?void 0:e.classList.remove(n["a"].WILL_ANIMATE);null===(t=this.ui.trigger)||void 0===t?void 0:t.classList.remove(n["a"].TRIGGER_WILL_ANIMATE);this.setState({isClosing:false,isOpening:false,isOpen:false});this.currentFocusIdx=void 0;this._animationTimeout=null;this._docClickListener=this._handleOutsideClickClose.bind(this);if(this._docClickListener){document.removeEventListener("click",this._docClickListener);document.removeEventListener("touchstart",this._docClickListener)}if(i){var s;null===(s=this.ui.trigger)||void 0===s?void 0:s.focus()}}))}toggle(){return this.state.isOpen?this.close():this.open()}isTargetSelectable(e){const t=e.getAttribute("role");const i="menuitemradio"===t;const n="INPUT"===e.tagName;const s=e instanceof HTMLInputElement&&("radio"===e.type||"checkbox"===e.type);return n&&s||i}select(e){const t=e.target||e.currentTarget;if(!(t instanceof HTMLElement))return;const i="INPUT"===t.tagName;const s=this.isTargetSelectable(t);if(s&&this.options.menuType===n["g"].OPTION){var o,r;const e=i&&t instanceof HTMLInputElement?t.value:null===(o=t.textContent)||void 0===o?void 0:o.trim();null===(r=this.ui.items)||void 0===r?void 0:r.forEach((t=>{var s;if((null===(s=t.textContent)||void 0===s?void 0:s.trim())===e){t.classList.add(n["a"].SELECTED);t.classList.add("wt-options__item--selected");t.setAttribute("aria-checked","true");i&&t.setAttribute("checked","true")}else{t.classList.remove(n["a"].SELECTED);t.classList.remove("wt-options__item--selected");t.removeAttribute("aria-checked");i&&t.removeAttribute("checked")}}))}s&&this.options.closeOnSelect&&this.close()}_setupVertOpen(){const e=this.vertOpenDirection;this.vertOpenDirection=this._getVertOpenDirection();if(this.vertOpenDirection!==e){this.ui.element.classList.remove(n["a"].PREFIX+e);if(!this.options.menuBodyBelowTrigger&&this.ui.body){this.ui.body.style.paddingBottom="0px";this.ui.body.style.paddingTop="0px"}}this.ui.element.classList.add(n["a"].PREFIX+this.vertOpenDirection);if(this.ui.body&&!this.options.menuBodyBelowTrigger&&!this.options.hideTriggerOnOpen){var t;const e=null===(t=this.triggerSizeAndPosition)||void 0===t?void 0:t.height;this.vertOpenDirection===l.VERT_DIRECTION.TOP?this.ui.body.style.paddingBottom=`${e}px`:this.ui.body.style.paddingTop=`${e}px`}}_getVertOpenDirection(){const e=l.VERT_DIRECTION.BOTTOM;if(this.options.openDirectionForce){var t;return null!==(t=this.options.openDirectionVert)&&void 0!==t?t:e}if("undefined"!==typeof window&&this.triggerSizeAndPosition&&this.menuBodyHeight&&this.triggerSizeAndPosition.bottom&&this.triggerSizeAndPosition.top){const e=document.documentElement.clientHeight;const t=e-this.triggerSizeAndPosition.bottom;const i=this.triggerSizeAndPosition.top;const n=this.menuBodyHeight<=t;const s=this.menuBodyHeight<=i;if(n||s){if(this.options.openDirectionVert===l.VERT_DIRECTION.BOTTOM)return n?l.VERT_DIRECTION.BOTTOM:l.VERT_DIRECTION.TOP;if(this.options.openDirectionVert===l.VERT_DIRECTION.TOP)return s?l.VERT_DIRECTION.TOP:l.VERT_DIRECTION.BOTTOM}const o=i+window.pageYOffset;const r=document.documentElement.scrollHeight-(window.pageYOffset+this.triggerSizeAndPosition.bottom);const a=this.menuBodyHeight<=o;const d=this.menuBodyHeight<=r;if(a||d){if(this.options.openDirectionVert===l.VERT_DIRECTION.TOP)return a?l.VERT_DIRECTION.TOP:l.VERT_DIRECTION.BOTTOM;if(this.options.openDirectionVert===l.VERT_DIRECTION.BOTTOM)return d?l.VERT_DIRECTION.BOTTOM:l.VERT_DIRECTION.TOP}}return e}_setupHorizOpen(){const e=this.horizOpenDirection;this.horizOpenDirection=this._getHorizOpenDirection();this.horizOpenDirection!==e&&this.ui.element.classList.remove(n["a"].PREFIX+e);this.ui.element.classList.add(n["a"].PREFIX+this.horizOpenDirection)}_getHorizOpenDirection(){const e=l.HORIZ_DIRECTION.LEFT;if(this.options.openDirectionForce){var t;return null!==(t=this.options.openDirectionHoriz)&&void 0!==t?t:e}if(this.triggerSizeAndPosition&&this.menuBodyHeight&&this.menuBodyWidth&&this.triggerSizeAndPosition.width&&this.triggerSizeAndPosition.left&&this.triggerSizeAndPosition.right){const t=this.menuBodyWidth-this.triggerSizeAndPosition.width;if(t<=0){var i;return null!==(i=this.options.openDirectionHoriz)&&void 0!==i?i:e}const n=document.documentElement.clientWidth;const s=this.triggerSizeAndPosition.left;const o=n-this.triggerSizeAndPosition.right;const r=t<=s;const a=t<=o;const d=t/2<=s&&t/2<=o;if(r||a||d){if(this.options.openDirectionHoriz===l.HORIZ_DIRECTION.CENTER){if(d)return l.HORIZ_DIRECTION.CENTER;return a?l.HORIZ_DIRECTION.LEFT:l.HORIZ_DIRECTION.RIGHT}if(this.options.openDirectionHoriz===l.HORIZ_DIRECTION.RIGHT)return r?l.HORIZ_DIRECTION.RIGHT:l.HORIZ_DIRECTION.LEFT;if(this.options.openDirectionHoriz===l.HORIZ_DIRECTION.LEFT)return a?l.HORIZ_DIRECTION.LEFT:l.HORIZ_DIRECTION.RIGHT}}return e}_handleKeydown(e){if(e.altKey||e.ctrlKey)return true;const t=document.activeElement;const i=e.key;if(s["default"].isTabKey(i)){if(this.state.isOpen)if(this.options.containFocus){e.preventDefault();this._moveFocus(e.shiftKey?l.FOCUS_DIRECTION.UP:l.FOCUS_DIRECTION.DOWN)}else setTimeout((()=>{this.close()}),0)}else if(s["default"].isEscKey(i))this.state.isOpen&&this.close();else if(s["default"].isEnterKey(i)){const i=e.target||e.currentTarget;if(this.state.isOpen||t!==this.ui.trigger){if(i instanceof HTMLElement&&"INPUT"===(null===i||void 0===i?void 0:i.tagName)&&this.state.isOpen){e.preventDefault();this.select(e)}}else{e.preventDefault();this.open(s["default"].ENTER_KEY)}}else if(s["default"].isSpaceKey(i)){if(this.state.isOpen&&e.target instanceof HTMLElement&&!this._isTargetFormElement(e.target)){e.preventDefault();this.select(e)}}else if(s["default"].isDownKey(i)){e.preventDefault();this.state.isOpen||t!==this.ui.trigger?this.state.isOpen&&this._moveFocus(l.FOCUS_DIRECTION.DOWN):this.open(s["default"].DOWN_KEY)}else if(s["default"].isUpKey(i)){e.preventDefault();this.state.isOpen||t!==this.ui.trigger?this.state.isOpen&&this._moveFocus(l.FOCUS_DIRECTION.UP):this.open(s["default"].UP_KEY)}else if(s["default"].isHomeKey(i)||s["default"].isPageUpKey(i)){var n;e.preventDefault();null===(n=this.$allMenuItems)||void 0===n?void 0:n.eq(0).focus()}else if(s["default"].isEndKey(i)||s["default"].isPageDownKey(i)){var o;e.preventDefault();null===(o=this.$allMenuItems)||void 0===o?void 0:o.eq(-1).focus()}return}_setFocus(e){this.currentFocusIdx=e;if(this.ui.items){var t;null===(t=this.ui.items[this.currentFocusIdx])||void 0===t?void 0:t.focus()}}_findItemIndex(e){var t;let i=-1;null===(t=this.ui.items)||void 0===t?void 0:t.forEach(((t,n)=>{t===e&&(i=n)}));return i}_moveFocus(e){let t=0;if(document.activeElement&&document.activeElement instanceof HTMLElement&&this.ui.element.contains(document.activeElement)){const e=this._findItemIndex(document.activeElement);e>=0&&(this.currentFocusIdx=e)}if(void 0!==this.currentFocusIdx){e===l.FOCUS_DIRECTION.DOWN&&(t=this.ui.items&&this.currentFocusIdx===this.ui.items.length-1?0:this.currentFocusIdx+1);e===l.FOCUS_DIRECTION.UP&&(t=this.ui.items&&0===this.currentFocusIdx?this.ui.items.length-1:this.currentFocusIdx-1)}this._setFocus(t)}_isTargetFormElement(e){return"undefined"!==typeof window&&(e instanceof window.HTMLInputElement||e instanceof window.HTMLTextAreaElement)}}a(l,"CONSTANTS",n["b"]);a(l,"FOCUS_DIRECTION",n["e"]);a(l,"VERT_DIRECTION",n["j"]);a(l,"HORIZ_DIRECTION",n["f"]);a(l,"DEFAULT_OPTIONS",{animateIn:true,closeOnSelect:true,containFocus:false,hideTriggerOnOpen:false,menuBodyBelowTrigger:false,menuType:n["g"].ACTION,triggerUpdateType:void 0,openDirectionForce:false,openDirectionHoriz:l.HORIZ_DIRECTION.LEFT,openDirectionVert:l.VERT_DIRECTION.BOTTOM});a(l,"DEFAULT_STATE",{isOpen:false,isOpening:false,isClosing:false});var d=l;function u(e){return e===n["g"].OPTION}function c(e){return void 0!==e&&Object.values(n["i"]).includes(e)}function h(e){let t=e.querySelector(`span.${n["a"].LABEL_SELECTED}`);if(null!==t)return t;t=document.createElement("span");t.classList.add(n["a"].LABEL_SELECTED);t.classList.add("wt-pl-xs-1");const i=e.querySelector(n["h"].LABEL_ELEMENT);null===i||void 0===i?void 0:i.appendChild(t);null===i||void 0===i?void 0:i.classList.add("wt-text-truncate");e.classList.add("wt-max-width-full");return t}function v(e,t,i,s){if(!u(i)||!c(s))return;const o=e&&e.textContent?e.textContent.trim():"";if(!o.length)return;s===n["i"].APPEND&&(h(t).textContent=o)}var m=i("I5vg");var f=i("oyZd");function E(e,t,i){t in e?Object.defineProperty(e,t,{value:i,enumerable:true,configurable:true,writable:true}):e[t]=i;return e}class p{constructor(e,t,i){var n,o;E(this,"menuCore",void 0);const r=Object(f["a"])(e);this.menuCore=new d(e,{...t,...r},{...i});null===(n=this.menuCore.ui.trigger)||void 0===n?void 0:n.addEventListener("click",this.menuCore.toggle.bind(this.menuCore));null===(o=this.menuCore.ui.items)||void 0===o?void 0:o.forEach((e=>{e.addEventListener("click",(e=>{this.menuCore.select(e);this._handleChoose(e)}));"true"===e.getAttribute("aria-checked")&&v(e,this.menuCore.ui.element,this.menuCore.options.menuType,this.menuCore.options.triggerUpdateType)}));this.menuCore.ui.element.addEventListener("keydown",(e=>{const t=s["default"].isSpaceKey(e.key)||s["default"].isEnterKey(e.key);if(document.activeElement instanceof HTMLElement){const i=this.menuCore.isTargetSelectable(document.activeElement);t&&i&&this._handleChoose(e)}this.menuCore._handleKeydown(e)}));this.menuCore.addListener((e=>{this.handleStateChange(e)}));this._initialize();if(!Object(m["a"])(e,"Menu - The element provided to the constructor does not exist"))return}_initialize(){return}handleStateChange(e){e.isClosing?this._handleClosing():e.isOpening?this._handleOpening():e.isOpen?this._handleOpen():this._handleClose()}_handleOpen(){this.menuCore.ui.element.dispatchEvent(new CustomEvent(n["c"].OPEN))}_handleOpening(){this.menuCore.ui.element.dispatchEvent(new CustomEvent(n["c"].BEFORE_OPEN))}_handleClosing(){this.menuCore.ui.element.dispatchEvent(new CustomEvent(n["c"].BEFORE_CLOSE))}_handleClose(){this.menuCore.ui.element.dispatchEvent(new CustomEvent(n["c"].CLOSE))}_handleChoose(e){this.menuCore.ui.element.dispatchEvent(new CustomEvent(n["c"].CHOOSE,e));if(null===e.target||!(e.target instanceof HTMLElement))return;v(e.target,this.menuCore.ui.element,this.menuCore.options.menuType,this.menuCore.options.triggerUpdateType)}}},YDjr:function(e,t,i){"use strict";i.d(t,"d",(function(){return n}));i.d(t,"g",(function(){return s}));i.d(t,"c",(function(){return o}));i.d(t,"i",(function(){return r}));i.d(t,"h",(function(){return a}));i.d(t,"a",(function(){return l}));i.d(t,"e",(function(){return d}));i.d(t,"j",(function(){return u}));i.d(t,"f",(function(){return c}));i.d(t,"b",(function(){return h}));const n={top:["bottom","top-right","top-left","bottom-right","bottom-left"],bottom:["top","bottom-right","bottom-left","top-right","top-left"],"top-left":["bottom-left","top-right","bottom-right","top","bottom"],"top-right":["bottom-right","top-left","bottom-left","top","bottom"],"bottom-left":["top-left","bottom-right","top-right","bottom","top"],"bottom-right":["top-right","bottom-left","top-left","bottom","top"]};const s={ACTION:"action",OPTION:"option"};const o={BEFORE_OPEN:"wtMenuBeforeOpen",OPEN:"wtMenuOpen",BEFORE_CLOSE:"wtMenuBeforeClose",CLOSE:"wtMenuClose",CHOOSE:"wtMenuChoose"};const r={APPEND:"append"};const a={TRIGGER_ELEMENT:"[data-wt-menu-trigger]",BODY_ELEMENT:"[data-wt-menu-body]",MENU_ITEMS:"[role='menu'] [role*='menuitem']:not([disabled]),[role='menu'] input:not([disabled]),[role='menu'] button:not([disabled]), [data-wt-menu-body] [data-wt-menu-item]",SELECTED_MENU_ITEM:"[role='menuitemradio'][aria-checked='true']",LABEL_ELEMENT:".wt-menu__trigger__label"};const l={PREFIX:"wt-menu--",HIDE_TRIGGER:"wt-menu--hide-trigger-on-open",SELECTED:"wt-is-selected",WILL_ANIMATE:"wt-menu__body--will-animate",TRIGGER_WILL_ANIMATE:"wt-menu__trigger--will-animate",LABEL_SELECTED:"wt-menu__trigger-label--selected",IS_OPEN:"wt-overlay__is-open"};const d={UP:"up",DOWN:"down"};const u={TOP:"top",BOTTOM:"bottom"};const c={LEFT:"left",RIGHT:"right",CENTER:"center"};const h={OPEN_ANIMATION_TIMEOUT:180}},foay:function(e,t,i){e.exports=i("VYFw")("foay")},jdS7:function(e,t,i){"use strict";function n(e,t,i){t in e?Object.defineProperty(e,t,{value:i,enumerable:true,configurable:true,writable:true}):e[t]=i;return e}class s{constructor(){n(this,"state",void 0);n(this,"elements",void 0);n(this,"listeners",void 0);this.elements={};this.listeners=[]}getState(){return this.state}setState(e,t){if("object"===typeof e)for(const i in e)void 0!==e[i]&&(this.state[i]=e[i]);else e in this.state&&void 0!==t&&(this.state[e]=t);this.notifyListeners()}addListener(e){this.listeners=this.listeners||[];this.listeners.push(e)}notifyListeners(){const e=this.getState();this.listeners=this.listeners||[];this.listeners.forEach((t=>{t(e)}))}setElements(e){this.elements={...this.elements,...e}}}t["a"]=s},oyZd:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));function n(e){const t={...e.dataset};for(const i in t){const e=t[i];if("true"!==e&&"false"!==e)continue;t[i]="true"===e}return t}},tRNE:function(e,t,i){"use strict";i.r(t);i.d(t,"CardsDropdown",(function(){return f}));var n=i("Kyuy");var s=i("/wG7");var o=i("KWsK");var r=i("+s1y");var a=i("H3fw");var l=i("68KA");var d=i("YDjr");function u(e,t,i){t in e?Object.defineProperty(e,t,{value:i,enumerable:true,configurable:true,writable:true}):e[t]=i;return e}const c={CONTEXT:".dropdown-category-menu",MENU_BODY:".card-dropdown__menu",SIDE_PANE:".card-dropdown__sidepane"};const h={KEY:"submenu",NAME:"Etsy\\Modules\\CategoryNav\\Specs\\DropdownSubmenu"};const v={KEY:"sidepane",NAME:"Etsy\\Modules\\CategoryNav\\Specs\\CategoriesWithImages"};const m=200;class f{constructor(){u(this,"context",null);u(this,"menu",null);u(this,"sidepaneItems",null);u(this,"nodes",[]);u(this,"sideNodes",[]);u(this,"hoverTimeout",void 0);u(this,"selectedParentNode",null);this.context=document.querySelector(c.CONTEXT);this.loadSpec()}loadSpec(){s["default"].fetchOne(h.KEY,h.NAME,{images_in_l2:true},"GET",true).done((e=>{if(e.output&&e.output[h.KEY]){var t;const i=null===(t=this.context)||void 0===t?void 0:t.querySelector(s["default"].DEFAULT_PLACEHOLDER_SELECTOR);if(i){i.outerHTML=e.output[h.KEY];this.init()}}else o["default"].captureMessage("Desktop Category Submenu NeuSpec data.output not defined",{level:"info",extra:{specKey:h.KEY,specName:h.NAME,data:e}})}))}init(){if(!this.context)return;this.menu=new n["a"](this.context,{closeOnSelect:false,openDirectionHoriz:"left",openDirectionForce:true,openDirectionVert:"bottom",menuBodyBelowTrigger:true});this.nodes=this.parseNodes();this.bindEvents();this.bindTrackers()}findNode(e,t){return t.find((t=>t.node.id===e))}parseNodes(){var e;const t=[];null===(e=this.context)||void 0===e?void 0:e.querySelectorAll('[role="menuitem"]').forEach((e=>{if("undefined"!==typeof e.dataset.node)try{const i=JSON.parse(window.atob(e.dataset.node));i&&t.push(i)}catch(i){o["default"].captureMessage("Could not parse category node",{level:"info"});false;return}}));return t}bindEvents(){var e,t,i;const n=null===(e=this.context)||void 0===e?void 0:e.querySelectorAll(".wt-menu__item");if(n){clearTimeout(this.hoverTimeout);n.forEach((e=>{e.addEventListener("mouseenter",this.handleHover.bind(this));e.addEventListener("mouseleave",this.handleMenuItemLeave.bind(this));e.addEventListener("keydown",(e=>{"Enter"===e.key?this.handleOpenSidePane(e,true):"ArrowRight"===e.key&&this.handleArrowRight(e)}))}))}null===(t=this.context)||void 0===t?void 0:t.addEventListener(d["c"].BEFORE_OPEN,(()=>{this.context instanceof HTMLElement&&l["Overlay"].dispatchOpenBackgroundOverlayIfEligible(this.context);!this.isSidePaneOpen()&&this.nodes.length>0&&this.openFirstParent()}));null===(i=this.context)||void 0===i?void 0:i.addEventListener(d["c"].BEFORE_CLOSE,(()=>{var e;this.context instanceof HTMLElement&&l["Overlay"].dispatchCloseBackgroundOverlayIfEligible(this.context);const t=null===(e=this.context)||void 0===e?void 0:e.querySelector(c.SIDE_PANE);this.selectedParentNode&&this.selectedParentNode.classList.remove("wt-bg-gray");if(t){t.innerHTML="";t.classList.add("wt-display-none");t.setAttribute("aria-hidden","true");this.sidepaneItems=null}}))}bindTrackers(){var e,t;null===(e=this.context)||void 0===e?void 0:e.addEventListener("mouseenter",Object(r["default"])(this.handleMouseLeave.bind(this),m),true);null===(t=this.context)||void 0===t?void 0:t.addEventListener("click",this.handleClickTracker.bind(this))}handleMouseLeave(e){e.stopPropagation();const t=e.target;if(!(t instanceof HTMLElement)||"undefined"===typeof t.dataset.level)return;const i=parseInt(t.dataset.level);a["default"].logEvent({event_name:"catnav_dropdown_item_hover",level:i,is_parent_button:"undefined"!==typeof t.dataset.parentId})}handleClickTracker(e){const t=e.target;if(!(t instanceof HTMLElement))return;if("undefined"===typeof t.dataset.level)return;const i=parseInt(t.dataset.level);a["default"].logEvent({event_name:"catnav_dropdown_item_click",level:i,is_parent_button:"undefined"!==typeof t.dataset.parentId})}handleHover(e){clearTimeout(this.hoverTimeout);const t=this.isSidePaneOpen()?m:0;this.hoverTimeout=setTimeout((()=>{this.handleOpenSidePane(e)}),t)}handleOpenSidePane(e,t=false){const i=e.target;if(!(i instanceof HTMLElement))return;if(i instanceof HTMLAnchorElement){window.location.href=i.href;return}if("undefined"===typeof i.dataset.nodeId)return;this.selectedParentNode&&this.selectedParentNode.classList.remove("wt-bg-gray");this.selectedParentNode=i;this.selectedParentNode.classList.add("wt-bg-gray");const n=this.findNode(parseInt(i.dataset.nodeId),this.nodes);if(n){e.preventDefault();e.stopPropagation();this.renderSidePane(n,t)}}handleMenuItemLeave(){clearTimeout(this.hoverTimeout)}handleArrowRight(e){e.preventDefault();if(this.sidepaneItems){var t;null===(t=this.sidepaneItems[0])||void 0===t?void 0:t.focus()}}renderSidePane(e,t=false){var i;const n=null===(i=this.context)||void 0===i?void 0:i.querySelector(c.SIDE_PANE);if(n){n.innerHTML="";this.sidepaneItems=null;const t=document.createElement("div");t.classList.add("wt-block-grid-lg-2","wt-block-grid-xl-3","wt-pl-xs-2","wt-pr-xs-2");t.innerHTML=e.children.map(this.renderPlaceholder.bind(this)).join("");n.appendChild(t);n.classList.remove("wt-display-none")}const r=this.shortenNodeData(e);s["default"].fetchOne(v.KEY,v.NAME,{category_data:JSON.stringify(r),limit:1},"GET",true).done((e=>{if(e.output&&e.output[v.KEY]){if(this.menu){if(!n)return;n.scrollTop=0;n.innerHTML=e.output[v.KEY];n.setAttribute("aria-hidden","false");if(n.firstElementChild instanceof HTMLElement){this.sidepaneItems=n.querySelectorAll("a");if(t){var i;null===(i=this.sidepaneItems[0])||void 0===i?void 0:i.focus();this.handleFocusSidepane()}}}}else{if(n){n.innerHTML="";n.classList.add("wt-display-none");n.setAttribute("aria-hidden","true");this.sidepaneItems=null}o["default"].captureMessage("Desktop Category Submenu NeuSpec data.output not defined",{level:"info",extra:{specKey:v.KEY,specName:v.NAME,data:e}})}}))}openFirstParent(){var e;const t=null===(e=this.context)||void 0===e?void 0:e.querySelector(".wt-menu__item");if(t){this.selectedParentNode=t;t.classList.add("wt-bg-gray")}const i=this.nodes[0];i&&this.renderSidePane(i)}isSidePaneOpen(){var e,t;return null!==(e=null===(t=this.sidepaneItems)||void 0===t?void 0:t.length)&&void 0!==e?e:0>0}handleFocusSidepane(){const e=this.sidepaneItems;null!==e&&e.length>0&&e.forEach(((t,i)=>{t.addEventListener("keydown",(t=>{if("ArrowDown"===t.key||"ArrowUp"===t.key){var n;t.preventDefault();t.stopPropagation();const s="ArrowDown"===t.key?1:-1;const o=(i+s+e.length)%e.length;null===(n=e[o])||void 0===n?void 0:n.focus()}else if("ArrowLeft"===t.key){var s;t.preventDefault();const e=null===(s=this.context)||void 0===s?void 0:s.querySelectorAll(".wt-menu__item");if(e){var o;null===(o=e[0])||void 0===o?void 0:o.focus()}}}))}))}renderPlaceholder(){return`\n                <div class="wt-block-grid__item card-dropdown__card wt-width-full wt-height-full wt-object-fit-cover">\n                    <div class="wt-card wt-skeleton-ui wt-card--transparent">\n                        <a class="wt-card__action-link" href="#">\n                            <span class="wt-screen-reader-only"></span>\n                        </a>\n                        <div class="wt-card__inner">\n                                            <img class="wt-width-full wt-height-full card-dropdown__image wt-object-fit-cover wt-object-fit-cover wt-bg-gray wt-width-full wt-skeleton-ui" >\n\n                            </div>\n                    </div>\n                    </div>\n        `}shortenNodeData(e){const t=[];const i={parent_node:{id:e.node.id,name:e.node.name,url:e.node.url,level:"1"},children:[]};e.children.forEach((e=>{t.push({id:e.node.id,name:e.node.name,url:e.node.url,level:e.node.level})}));i.children=t;return i}}}}]);
//# sourceMappingURL=https://www.etsy.com/sourcemaps/evergreenVendor/en-GB/async/common-entrypoints/auto/@etsy-modules/CategoryNav/Views/DropdownMenu/CardsDropdown/Menu.e3aeae1e7246df03778e.js.map